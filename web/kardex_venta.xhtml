<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
	<h:outputScript library="js" name="kardex_ventas.js" target="head" />
    </h:head>
    <body>
        <ui:composition template="./plantillas/tareas.xhtml">   
            <ui:define name="content">             
                <h:form id="formBuscar">
                        <p:focus context="panel"/>
                        <div class="contenedor-superior">
                            <div class="contenedor-nombre-modulo">
                                <h1>VENTAS</h1>
                            </div>
                            <div class="contenedor-numero-factura">
                                <h1>Factura No :<p:outputLabel  id="numeroFactura" value="#{kardexVentaBean.kardexVenta.numero_factura}"/></h1>
                            </div>
                        </div>
                        <center>
                            <h:panelGrid id="panel" columns="2">
                                <p:inputText   id="idBuscador"  onkeyup="enfocarTareasBuscador()" class="idBuscador form-control" value="#{kardexVentaBean.cadenaNombre}" placeholder="Buscar Producto"/>
                                <p:commandButton value="Buscar" class="btn btn-primary" actionListener="#{kardexVentaBean.buscarProducto()}" update="resultadoBuscar" />
                            </h:panelGrid>
                            <br/>
                        </center>
                        <div class="contenedor-tabla-busqueda">
                            <p:dataTable id="resultadoBuscar" value="#{kardexVentaBean.listaInventario}" var="inv" paginator="true" rows="5" rowIndexVar="rowIndex">
                                <p:ajax event="rowSelect" />
                                <p:column headerText="Código">
                                    <p:outputLabel value="#{inv.cod_entrada}" />
                                </p:column>
                                <p:column headerText="Nombre Producto" width="30%">
                                    <p:outputLabel class="texto-resaltado" value="#{inv.nombre_producto}" />
                                </p:column>

                                <p:column headerText="Un/Medida">
                                    <p:outputLabel value=" #{inv.concentracion}/#{inv.presentacion}" />
                                </p:column>

                                <p:column headerText="Laboratorio" >
                                    <p:outputLabel value="#{inv.laboratorio}" />
                                </p:column> 
                                <p:column headerText="Tipo">
                                    <p:outputLabel value="#{inv.categoria}" />
                                </p:column> 
                                <p:column headerText="Fecha Vencimiento">
                                    <p:outputLabel value="#{inv.fecha_vencimiento}"/>
                                </p:column>
                                <p:column headerText="Cant." width="4%">
                                    <p:outputLabel value="#{inv.cantidad}"/>
                                </p:column>
                                <p:column headerText="Precio/Un.">
                                    <p:outputLabel value="#{inv.total_precio}">
                                        <f:convertNumber type="currency" currencySymbol="$" minFractionDigits="0"/>
                                    </p:outputLabel>
                                </p:column>
                                <p:column>
                                    <p:commandButton value="Adicionar" onkeyup="desplazamientoPorTablaBusqueda(this)" class="btn btn-warning boton-adicionar"  actionListener="#{kardexVentaBean.leerIdInventario(inv)}"  oncomplete="PF('wDialogoCantidad').show()" update=":dDialogoCantidad :formTransaccion"/>                                
                                </p:column>
                        </p:dataTable>
                    </div>
                </h:form>
                <p:dialog widgetVar="wDialogoCantidad"  id="dDialogoCantidad" header="KardexKdd(Cantidad Venta)" modal="true" closeOnEscape="true" onHide="enfocarCampoBuscar()">
                    <h:form>
                        <p:focus context="panel1"/>
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <h:panelGrid id="panel1">
                        <center>
                            <h1><b>#{kardexVentaBean.itemProducto.nombre_producto}/ #{kardexVentaBean.itemProducto.concentracion} </b></h1><br/>
                            <h1><b>#{kardexVentaBean.itemProducto.presentacion}/#{kardexVentaBean.itemProducto.categoria}</b></h1>
                            <h1><b>Precio: $ #{kardexVentaBean.itemProducto.total_precio}</b></h1>
                        </center>
                        
                        <center>
                            <p:outputLabel value="Cantidad" for="dCantidad"/>
                            <p:inputText id="dCantidad" type="number"  size="4" value="#{kardexVentaBean.itemCantidad}" label="Cantidad" required="true">
                                <f:convertNumber integerOnly="true"  type="number" />
                                <f:validator validatorId="validatorCero"/>
                            </p:inputText>
                        </center><br/>
                        <p:commandButton value="Agregar"  actionListener="#{kardexVentaBean.adicionarListaKardexItemVenta(kardexVentaBean.itemProducto, kardexVentaBean.itemCantidad)}" update=":formTransaccion:resultadoTransaccion :formTransaccion:idTotalPago :formBuscar:idBuscador" oncomplete="PF('wDialogoCantidad').hide();enfocarCampoBuscar()">
                            </p:commandButton>
                        </h:panelGrid>
                    </h:form>
                </p:dialog>
                <h:form id="formTransaccion">
                    <div class="contenedor-carrito">
                        <div class="contenedor-orden">
                            <center><b>ORDEN DE VENTA</b></center><br/>
                            <p:growl autoUpdate="true" id="message"  showDetail="true"/>
                            <p:dataTable id="resultadoTransaccion" value="#{kardexVentaBean.kardexVenta.listaItemsVenta}" var="item" paginator="true" rows="3">
                                <p:column headerText="Eliminar" id="seleccion" >
                                    <center><p:commandButton class="btn btn-danger boton-eliminar" onkeypress="enfocarCampoBuscar()" onkeyup="enfocarEliminarItems(this)" value="Eliminar" actionListener="#{kardexVentaBean.eliminarItemVenta(item)}" update="resultadoTransaccion :formTransaccion:idTotalPago" /></center>
                                </p:column>
                                <p:column headerText="Código">
                                    <center><p:outputLabel value="#{item.inventario.cod_entrada}" /></center>
                                </p:column>
                                <p:column headerText="Nombre Producto" width="50%">
                                    <center><p:outputLabel class="texto-resaltado" value="#{item.inventario.nombre_producto}" /></center>
                                </p:column>
                                <p:column headerText="cant." id="count" width="4%">
                                    <center>
                                        <p:outputLabel id="pro_iva"  value="#{item.cantidad}" >
                                            <f:convertNumber integerOnly="true"  type="number" />
                                        </p:outputLabel>
                                    </center>
                                </p:column> 
                                <p:column headerText="Total">
                                    <center>
                                        <p:outputLabel  value="#{item.inventario.total_precio}">
                                            <f:convertNumber type="currency" currencySymbol="$" minFractionDigits="0"/>
                                        </p:outputLabel>
                                    </center>
                                </p:column>
                             </p:dataTable>
                            
                        </div>
                        <div class="contenedor-valores">
                            <br/><br/>
                           <h1><b>Total a Pagar </b></h1>
                           <p>
                                <p:outputLabel id="idTotalPago" class="total_pago" value="#{kardexVentaBean.totalPago}">
                                    <f:convertNumber type="currency" currencySymbol="$" minFractionDigits="0"/>
                                </p:outputLabel>
                           </p>
                        </div>
                    </div>
                    <center>
                        <br/>
                        <p:commandButton ajax="true" value="Venta Contado"    onkeyup="enfocarTareasVentas()"  class="btnVentaContado" oncomplete="PF('wFactura').show();"   update=":dFactura formTransaccion :formFactura:items">
                        
                        </p:commandButton>
                        <!--p:commandButton value="Venta Crédito" oncomplete="PF('wDialogoCliente').show()" onclick="#{kardexVentaBean.setActivarBotonCliente('show')}"/-->
                        <!--p:commandButton value="Factura" actionListener="#{kardexVentaBean.generarFactura()}" oncomplete="PF('wFactura').show()" update=":dFactura"/-->
                    </center>
                </h:form>
                
                
                <p:dialog widgetVar="wFactura"   id="dFactura" header="KardexKDD(Factura)" width="300px" height="450px" modal="true" closeOnEscape="true" onHide="enfocarCampoVentaContado()">
                    <div class='contenedor_impresora'>
                    <h:form id="formFactura" >
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <center>
                            <p:outputLabel value="#{kardexVentaBean.empresa.nombre_empresa}"/><br/>
                            <p:outputLabel value="Nit:#{kardexVentaBean.empresa.nit_empresa}"/><br/>
                            <p:outputLabel value="Dirección:#{kardexVentaBean.empresa.direccion}"/><br/>
                            <p:outputLabel value="Teléfono:#{kardexVentaBean.empresa.telefono}"/><br/>
                            <p:outputLabel value="Ciudad:#{kardexVentaBean.empresa.ciudad}"/>
                            <br/>
                            <b>...........................................</b>
                            <br/>                            
                            <p:outputLabel value="Factura No: #{kardexVentaBean.kardexVenta.numero_factura}"/><br/>
                            <p:outputLabel value="Cajero: #{sessionBean.nombre}"/><br/>
                            <p:outputLabel value="Fecha: #{kardexVentaBean.fecha}"/><br/>
                            <p:outputLabel value="Hora: #{kardexVentaBean.hora}"/>
                            <br/>
                            <b>...........................................</b> 
                            <br/>
                            <p:dataTable id='items'  value="#{kardexVentaBean.listaRecibos}" var="fac"  style="text-height: 5px;border: 0;">
                                <p:column headerText="Item" width="60%" >
                                <p:outputLabel value="#{fac.variable}" />
                            </p:column>
                            <p:column headerText="Ct" width="10%">
                                <p:outputLabel value="#{fac.cantidad}"/>
                            </p:column>
                            <p:column headerText="Total" width="30%">
                                <p:outputLabel value="#{fac.total}">
                                    <f:convertNumber type="currency" maxFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                            <br/>
                            <b>...........................................</b>
                            <br/>
                            <p:outputLabel value="Valor Total: "/>
                            <p:outputLabel value="#{kardexVentaBean.totalPago}">
                               <f:convertNumber type="currency" maxFractionDigits="0"/> 
                            </p:outputLabel>
                        <br/>
                        </center>
                    </h:form>
                        </div>
                    <h:form>
                        <p:focus/>
                            <br/>
                            <center>
                                <p:commandButton  value="Feacturar"  onkeyup="direccionBotonFacturar()" class="boton-facturar" action="#{kardexVentaBean.registrarVentaContado(sessionBean.empleado)}"  update=":formTransaccion"/>
                                <p:commandButton value="Facturar e Imprimir" onkeyup="direccionBotonImprimir()" class="boton-imprimir"  >
                                    <p:ajax listener="#{kardexVentaBean.registrarVentaContado(sessionBean.empleado)}" oncomplete="imprimir()"/>
                                </p:commandButton>
                            </center>   
                    </h:form>
                </p:dialog>
                
                
                <p:dialog widgetVar="wDialogoCliente" id="dDialogoCliente" header="KardexKdd(Asignar Cliente)" modal="true">
                    <h:form id="formVerificarCliente">
                        <p:growl/>
                        <p:outputLabel value="Identificación" />
                        <p:inputText  value="#{kardexVentaBean.cliente.cedula_cliente}"/><hr/>
                        <center>
                            <p:commandButton value="Verificar" actionListener="#{kardexVentaBean.buscarClienteCedula()}" update=":formCliente"/>
                            <p:commandButton value="Buscar cliente" oncomplete="PF('wDialogoBuscar').show()" update=":dDialogoBuscar"/>
                        </center>
                    </h:form>
                    <hr/>
                    <h:form id="formCliente">
                        <center>
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <h:panelGrid columns="2">
                            <p:outputLabel value="Cedula" for="cliCedula"/>
                            <p:inputText  id="cliCedula" value="#{kardexVentaBean.cliente.cedula_cliente}" required="true" readonly="#{kardexVentaBean.activarCamposCliente}" accesskey="cliNombres"/>
                            <p:outputLabel value="Nombres" for="cliNombres"/>
                            <p:inputText  id="cliNombres" value="#{kardexVentaBean.cliente.nombres}" required="true" readonly="#{kardexVentaBean.activarCamposCliente}" accesskey="cliApellidos"/>
                            <p:outputLabel value="Apellidos" for="cliApellidos"/>
                            <p:inputText  id="cliApellidos" value="#{kardexVentaBean.cliente.apellidos}" required="true" readonly="#{kardexVentaBean.activarCamposCliente}"/>
                            <p:outputLabel value="Dirección" for="cliDireccion"/>
                            <p:inputText  id="cliDireccion" value="#{kardexVentaBean.cliente.direccion}" readonly="#{kardexVentaBean.activarCamposCliente}"/>
                            <p:outputLabel value="Teléfono" for="cliTelefono"/>
                            <p:inputText  id="cliTelefono" value="#{kardexVentaBean.cliente.telefono}" readonly="#{kardexVentaBean.activarCamposCliente}"/>
                        </h:panelGrid>
                            <hr/>
                        <h:panelGrid columns="2">
                            <p:outputLabel value="Detalle" for="cxcDetalle"/>
                            <p:inputTextarea id="cxcDetalle" style="size: 200" value="#{kardexVentaBean.detalleCxC}"/>
                        </h:panelGrid>   
                            <hr/>
                            <p:commandButton value="Guardar Usuario" style="display:#{kardexVentaBean.activarBotonCliente}" actionListener="#{kardexVentaBean.guardarCliente(kardexVentaBean.cliente)}" update="formCliente"/>
                            <p:commandButton value="Ejecutar Venta" style="display:#{kardexVentaBean.activarBotonEjecutarVenta}" action="#{kardexVentaBean.registrarVentaCredito(sessionBean.empleado)}" />
                                <p:commandButton value="Cancelar"/>     
                        </center>                       
                    </h:form>
                </p:dialog>
                <p:dialog widgetVar="wDialogoBuscar" id="dDialogoBuscar" header="KardexKdd(Buscar Cliente)" modal="true">
                    <center>
                        <h:form>
                            <p:outputLabel value="Nombre Cliente" for="bNombre"/>
                            <p:inputText value="#{kardexVentaBean.cadenaClienteNombre}" id="bNombre"/>
                            <p:commandButton value="Buscar" actionListener="#{kardexVentaBean.buscarClienteNombre()}" update=":formListaClientes:tablaClientes"/>
                        </h:form>
                        <h:form id="formListaClientes">
                            <p:dataTable id='tablaClientes' value="#{kardexVentaBean.listaClientes}" var="cli" paginator="true" rows="6">
                                <p:column headerText="Cédula">
                                    <p:outputLabel value="#{cli.cedula_cliente}"/>
                                </p:column>
                                <p:column headerText="Nombres">
                                    <p:outputLabel value="#{cli.nombres}"/>
                                </p:column>
                                <p:column headerText="Apellidos">
                                    <p:outputLabel value="#{cli.apellidos}"/>
                                </p:column>
                                <p:column headerText="Dirección">
                                    <p:outputLabel value="#{cli.direccion}"/>
                                </p:column>
                                <p:column headerText="Teléfono">
                                    <p:outputLabel value="#{cli.telefono}"/>
                                </p:column>
                                <p:column headerText="Teléfono">
                                    <p:commandButton value="Seleccionar" actionListener="#{kardexVentaBean.cliente.setCedula_cliente(cli.cedula_cliente)}" oncomplete="PF('wDialogoBuscar').hide()" update=":formVerificarCliente"/>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </center>
                </p:dialog>
            </ui:define>
        </ui:composition>
    </body>
</html>
